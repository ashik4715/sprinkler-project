<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css
    "
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js
    "></script>
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
      crossorigin="anonymous"
    ></script>

    <!-- Load chart js into the DOM -->
    <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1.1/dist/chart.xkcd.min.js"></script>

    <link rel="stylesheet" href="style.css" />
    <title>Sprinkler Project</title>
  </head>
  <body>
    <div class="container">
      <form action="" class="form-detection">
        <div class="row text-light">
          <div class="col">
            <h1 class="text-dark display-5 pt-4">
              <strong>Sprinkler Response Time</strong>
            </h1>
            <p class="text-light fst-italic py-3">
              Put desired value in the box or chose the pre-determined value by
              ticking one of the suggested options
            </p>

            <!-- RTI Row -->
            <div class="row pb-3">
              <div class="col-5">Response Time Index (RTI)</div>
              <div class="col-5">
                <input
                  class="text-center"
                  type="text"
                  id="numberField"
                  name="RTI"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
                <h6 style="display: inline-flex">&radic;m&lowast;&radic;s</h6>
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>

            <!-- Height Row -->
            <div class="row py-2">
              <div class="col-5">Height</div>
              <div class="col-5">
                <input
                  class="text-center"
                  type="text"
                  id="H"
                  name="H"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
                <h6 style="display: inline-flex">m</h6>
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>

            <!-- Radial Distance Row -->
            <div class="row py-3">
              <div class="col-5">radial distance</div>
              <div class="col-5">
                <input
                  class="text-center"
                  type="text"
                  id="R"
                  name="R"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
                <h6 style="display: inline-flex">m</h6>
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>

            <!-- Aplha Row -->
            <div class="row py-3">
              <div class="col-5">Fire Growth Rate, &alpha;</div>
              <div class="col-5">
                <input
                  class="text-center"
                  name="alpha"
                  type="text"
                  id="alpha"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
                <h6 style="display: inline-flex">kW/s&sup2;</h6>
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>

            <!-- Activation Temperature row -->
            <div class="row py-3">
              <div class="col-5">Activation Temperature</div>
              <div class="col-5">
                <input
                  class="text-center"
                  name="tAmbient"
                  type="text"
                  id="tAmbient"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
                <h6 style="display: inline-flex">&#8451;</h6>
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>
            <!-- Ambience Temperature row -->
            <div class="row py-3">
              <div class="col-5">Ambience Temperature</div>
              <div class="col-5">
                <input
                  class="text-center"
                  name="tAct"
                  type="text"
                  id="tAct"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
                <h6 style="display: inline-flex">&#8451;</h6>
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>
            <!-- end Ambience Temperature row -->

            <!-- Total Time Steps Row -->
            <div class="row pb-3">
              <div class="col-5">Time Steps</div>
              <div class="col-5">
                <input
                  class="text-center"
                  type="text"
                  id="timeStep"
                  name="timeStep"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>

            <!-- Total Duration Row -->
            <div class="row pb-3">
              <div class="col-5">Total Duration</div>
              <div class="col-5">
                <input
                  class="text-center"
                  type="text"
                  id="duration"
                  name="duration"
                  placeholder="Input value"
                  style="
                    border: 1px solid;
                    border-radius: 1rem;
                    max-width: 150px;
                  "
                  required
                />
                <h6 style="display: inline-flex">s</h6>
              </div>
              <div class="col">
                <!-- modal start -->
                <!-- Button trigger modal -->
                <button
                  type="button"
                  class="btn btn-outline-dark btn-circle"
                  data-bs-toggle="modal"
                  data-bs-target="#staticBackdrop"
                >
                  !
                </button>
                <div
                  class="modal fade"
                  id="staticBackdrop"
                  data-bs-backdrop="static"
                  data-bs-keyboard="false"
                  tabindex="-1"
                  aria-labelledby="staticBackdropLabel"
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">
                          Modal title
                        </h5>
                        <button
                          type="button"
                          class="btn-close"
                          data-bs-dismiss="modal"
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">...</div>
                      <div class="modal-footer">
                        <button
                          type="button"
                          class="btn btn-secondary"
                          data-bs-dismiss="modal"
                        >
                          Close
                        </button>
                        <button type="button" class="btn btn-primary">
                          Understood
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- modal end -->
              </div>
            </div>

            <section class="sprinkler-result">
              <div class="row py-2">
                <div class="col-sm">
                  <p>Activation time</p>
                  <p>Fire Size</p>
                </div>
                <div class="col-sm">
                  <p class="result-style" id="activationTimeResult"></p>
                  <p class="result-style" id="fireSizeResult"></p>
                </div>
              </div>
            </section>
          </div>

          <!-- Results -->
          <div class="col">
            <div class="accordion pt-4" id="accordionExample">
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                  <button
                    class="accordion-button"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseOne"
                    aria-expanded="true"
                    aria-controls="collapseOne"
                  >
                    Governing Equations
                  </button>
                </h2>
                <div
                  id="collapseOne"
                  class="accordion-collapse collapse show"
                  aria-labelledby="headingOne"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body">
                    <img
                      class="img-fluid"
                      src="img/equations.png"
                      alt="equations"
                    />
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingTwo">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseTwo"
                    aria-expanded="false"
                    aria-controls="collapseTwo"
                  >
                    Accordion Item #2
                  </button>
                </h2>
                <div
                  id="collapseTwo"
                  class="accordion-collapse collapse"
                  aria-labelledby="headingTwo"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body">
                    <code>.accordion-body</code>, though the transition does
                    limit overflow.
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingThree">
                  <button
                    class="accordion-button collapsed"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseThree"
                    aria-expanded="false"
                    aria-controls="collapseThree"
                  >
                    Accordion Item #3
                  </button>
                </h2>
                <div
                  id="collapseThree"
                  class="accordion-collapse collapse"
                  aria-labelledby="headingThree"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body">
                    <strong>This is the third item's accordion body.</strong>
                  </div>
                </div>
              </div>
            </div>

            <p class="text-light fst-italic py-3">
              The correlations for jet temperatures and velocities were
              developed from data by Alpert
            </p>
          </div>
        </div>
        <div class="row py-2 pt-4">
          <div class="col">
            <button class="btn btn-calculate" type="submit">Calculate</button>
          </div>
          <div class="col">
            <button class="btn btn-clear" type="button">Clear Data</button>
          </div>
          <div class="col">
            <button class="btn btn-info" type="button" id="download" data="">
              Download
            </button>
          </div>
          <div class="col">
            <button class="btn btn-print" type="button">Print Results</button>
          </div>
        </div>
      </form>
    </div>

    <div class="activation-plot py-5">
      <div class="container-lg">
        <!-- <svg class="line-chart" style="max-height: 675px"></svg> -->
      </div>
    </div>
  </body>

  <!-- inputs and radio button Javascript Below -->
  <script>
    $(document).ready(function () {
      $(".btn-outline-dark").click(function (e) {
        // var radioAlpha = $("input[name='flexRadioDefault']:checked").val();
        var radioAlpha = $(this).val();
        console.log(radioAlpha);
        e.preventDefault();
        if (radioAlpha) {
          document.querySelector("#alpha").value = radioAlpha;
        }
      });

      $("input.text-center").on("input", function () {
        this.value = this.value
          .replace(/[^0-9.]/g, "")
          .replace(/(\..*?)\..*/g, "$1");
      });
    });
  </script>

  <!-- Excel Generate Javascript Below -->
  <script>
    $(document).ready(function () {
      // define the arrays to store the values
      var arr1 = [];
      var arr2 = [];
      var arr3 = [];
      var arr4 = [];
      var arr5 = [];
      var arr6 = [];
      var csv = "time,Q, Vgas, Tgas,deltaT, Tbulb\n";

      var RTI = $("input[name='RTI']").val();
      var R = $("input[name='R']").val();
      var H = $("input[name='H']").val();
      var radioAmbient = $("input[name='tAmbient']").val();
      var radioAct = $("input[name='tAct']").val();
      const numAmbientParsed = parseFloat(radioAmbient);
      const numActParsed = parseFloat(radioAct);
      var tAmbientVal = numAmbientParsed + 273;
      var tActVal = numActParsed + 273;
      var alphaVal = $("input[name='alpha']").val();
      var Vgas, Tgas, activationTime, fireSize, Q, tau, deltaT;

      $(".btn-clear").click(function () {
        $("form")[0].reset();
      });
      $("form").submit(function (event) {
        event.preventDefault(); // prevent default form submission

        var rti = $("input[name='RTI']").val();
        var H = $("input[name='H']").val();
        var R = $("input[name='R']").val();
        var alphaVal = $("input[name='alpha']").val();
        var radioAmbient = $("input[name='tAmbient']").val();
        var radioAct = $("input[name='tAct']").val();
        var timeStep = $("input[name='timeStep']").val();
        var duration = $("input[name='duration']").val();
        const numAmbientParsed = parseFloat(radioAmbient);
        const numActParsed = parseFloat(radioAct);
        var Activation = numAmbientParsed + 273;
        var Ambient = numActParsed + 273;
        var Tbulb = 293;
        var TbulbCounter = 0;
        let TactivationTimePrint = 0;
        let FireSizeOfQ = 0;

        function round(num, decimalPlaces = 0) {
          num = Math.round(num + "e" + decimalPlaces);
          return Number(num + "e" + -decimalPlaces);
        }
        // vGas-result, tGas-result, activationTime-result, fireSize-result
        for (var i = 0; i < duration; timeStep++) {
          var preQ = alphaVal * Math.pow(timeStep, 2);
          Q = round(preQ, 2);
          if (R / H > 0.15) {
            Vgas = parseFloat(
              (0.2 * Math.pow(Q, 1 / 3) * Math.pow(H, 1 / 2)) /
                Math.pow(R, 5 / 6)
            );
          }
          if (R / H <= 0.15) {
            Vgas = parseFloat(0.95 * Math.pow(Q / H, 1 / 3));
          }
          if (R / H > 0.18) {
            Tgas = parseFloat(Ambient + (5.38 / H) * Math.pow(Q / R, 2 / 3));
          }
          if (R / H <= 0.18) {
            Tgas = parseFloat(
              Ambient + (16.9 * Math.pow(Q, 2 / 3)) / Math.pow(H, 5 / 3)
            );
          }

          tau = round(rti / Math.sqrt(Vgas), 1);
          deltaT = (1 / tau) * (Tgas - Ambient);
          Tbulb = parseFloat(Tgas) + parseFloat(deltaT);
          TbulbCounter = parseFloat(Tbulb) + parseFloat(deltaT);
          if (TbulbCounter > Activation) {
            TactivationTimePrint = i;
            FireSizeOfQ = preQ;
            break;
          }
          console.log(
            "Tbulb,TbulbCounter,tau, Q, Vgas, Tgas, delta",
            "\n",
            +Tbulb +
              ", " +
              Math.round(TbulbCounter, 1) +
              ", " +
              tau +
              ", " +
              Q +
              " , " +
              Vgas +
              " , " +
              Tgas +
              " , " +
              deltaT
          );

          arr1.push(i);
          arr2.push(Q);
          arr3.push(Vgas);
          arr4.push(Tgas);
          arr5.push(deltaT);
          arr6.push(Tbulb);
          i++;
        }

        // export the arrays to CSV
        for (var i = 1; i < arr1.length; i++) {
          csv +=
            arr1[i] +
            "," +
            arr2[i] +
            "," +
            arr3[i] +
            "," +
            arr4[i] +
            "," +
            arr4[i] +
            "," +
            arr5[i] +
            "," +
            arr6[i] +
            "\n";
        }
        //Print Results
        console.log("Activation Time : ", TactivationTimePrint);
        $("#activationTimeResult").html(
          TactivationTimePrint.toFixed(0) + " seconds"
        );
        console.log("Fire Size : ", FireSizeOfQ.toFixed(0));
        $("#fireSizeResult").html(FireSizeOfQ.toFixed(0) + " KW");
      });

      // handle data button click
      $("#download").click(function (event) {
        event.preventDefault();
        // create a temporary link element and click it to trigger download
        var link = document.createElement("a");
        link.setAttribute(
          "href",
          "data:text/csv;charset=utf-8," + encodeURIComponent(csv)
        );
        link.setAttribute("download", "data.csv");
        link.style.display = "none";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });
    });
  </script>
  <!-- Excel Generate Javascript Below -->
</html>
