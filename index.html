<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css
    "
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js
    "></script>
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
      crossorigin="anonymous"
    ></script>

    <!-- Load chart js into the DOM -->
    <script src="https://cdn.jsdelivr.net/npm/chart.xkcd@1.1/dist/chart.xkcd.min.js"></script>

    <link rel="stylesheet" href="style.css" />
    <title>Sprinkler Project</title>
  </head>
  <body>
    <div class="container">
      <h2 class="text-center text-light py-3">Sprinkler/Detector Activation</h2>

      <div class="row text-light">
        <div class="col">
          <form action="" class="form-detection">
            <h4 class="text-info pb-2">Detection / Sprinkler Response Time</h4>
            <p class="text-light fst-italic py-3">
              Put desired value in the box or chose the pre-determined value by
              ticking one of the suggested options
            </p>

            <!-- RTI Row -->
            <div class="row pb-3">
              <div class="col-sm">
                RTI <br />
                (Response Time Index)
              </div>
              <div class="col-sm">
                <input
                  class="text-center"
                  type="text"
                  id="numberField"
                  name="RTI"
                  placeholder="Slide Or Input RTI"
                  required
                />
                &radic;m&lowast;s
              </div>
            </div>

            <!-- Height Row -->
            <div class="row py-2">
              <div class="col-sm">Height</div>
              <div class="col-sm">
                <input
                  class="text-center"
                  type="text"
                  id="H"
                  name="H"
                  placeholder="Slide Or Input Height"
                  required
                />
                m
              </div>
            </div>

            <!-- Radial Distance Row -->
            <div class="row py-3">
              <div class="col-sm">radial distance</div>
              <div class="col-sm">
                <input
                  class="text-center"
                  type="text"
                  id="R"
                  name="R"
                  placeholder="Slide radial ristance"
                  required
                />
                m
              </div>
            </div>

            <!-- Aplha Row -->
            <div class="row py-3">
              <div class="col-sm">
                &alpha; <br />
                Based on T sqaure Fire Q = &alpha;t&sup2;
              </div>
              <div class="col-sm">
                <input
                  class="text-center"
                  name="alpha"
                  type="text"
                  id="alpha"
                  placeholder="&alpha; required"
                  required
                />kW/s&sup2;
              </div>
              <div class="col-sm">
                <ul
                  style="list-style-type: none"
                  class="list-group list-group-horizontal-md"
                >
                  <li class="px-2">
                    <div class="form-check">
                      <button
                        class="btn btn-outline-dark btn-sm"
                        name="flexRadioDefault"
                        id="flexRadioDefault"
                        value="0.003"
                        style="border: 2px solid; border-radius: 3rem"
                      >
                        Slow
                      </button>
                    </div>
                    <div class="form-check">
                      <button
                        class="btn btn-outline-dark btn-sm"
                        name="flexRadioDefault"
                        id="flexRadioDefault"
                        value="0.012"
                        style="border: 2px solid; border-radius: 3rem"
                      >
                        Medium
                      </button>
                    </div>
                  </li>
                  <li class="px-2">
                    <div class="form-check">
                      <button
                        class="btn btn-outline-dark btn-sm"
                        name="flexRadioDefault"
                        id="flexRadioDefault"
                        value="0.047"
                        style="border: 2px solid; border-radius: 3rem"
                      >
                        Fast
                      </button>
                    </div>

                    <div class="form-check">
                      <button
                        class="btn btn-outline-dark btn-sm"
                        name="flexRadioDefault"
                        id="flexRadioDefault"
                        value="0.188"
                        style="border: 2px solid; border-radius: 3rem"
                      >
                        Ultrafast
                      </button>
                    </div>
                  </li>
                </ul>
              </div>
            </div>

            <!-- Activation Temperature row -->
            <div class="row py-3">
              <div class="col-sm">Activation Temperature</div>
              <div class="col-sm">
                <input
                  class="text-center"
                  name="tAmbient"
                  type="text"
                  id="tAmbient"
                  placeholder="Temperature required"
                  onwheel="return false;"
                  required
                />&#8451;
              </div>
              <div class="col-sm"></div>
            </div>
            <!-- Ambience Temperature row -->
            <div class="row py-3">
              <div class="col-sm">Ambience Temperature</div>
              <div class="col-sm">
                <input
                  class="text-center"
                  name="tAct"
                  type="text"
                  id="tAct"
                  placeholder="Ambience required"
                  onwheel="return false;"
                  required
                />&#8451;
              </div>
              <div class="col-sm"></div>
            </div>
            <!-- end Ambience Temperature row -->

            <div class="row py-2">
              <div class="col-sm">
                <p>Activation time</p>
                <p>Fire Size</p>
              </div>
              <div class="col-sm">
                <p class="result-style" id="activationTimeResult"></p>
                <p class="result-style" id="fireSizeResult"></p>
              </div>
            </div>

            <div class="row py-2 pt-4">
              <div class="col">
                <button class="btn btn-calculate" type="submit">
                  Calculate
                </button>
              </div>
              <div class="col">
                <button class="btn btn-clear" type="button">Clear Data</button>
              </div>
              <div class="col">
                <button class="btn btn-print" type="button">
                  Print Results
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Results -->
        <div class="col">
          <img class="img-fluid" src="img/equations.png" alt="equations" />
          <p class="text-light fst-italic py-3">
            The correlations for jet temperatures and velocities were developed
            from data by Alpert
          </p>
          <canvas class="pb-5"></canvas>
        </div>
      </div>
    </div>

    <div class="activation-plot py-5">
      <div class="container-lg">
        <!-- <svg class="line-chart" style="max-height: 675px"></svg> -->
      </div>
    </div>
  </body>

  <!-- inputs and radio button Javascript Below -->
  <script>
    $(document).ready(function () {
      $(".btn-outline-dark").click(function (e) {
        // var radioAlpha = $("input[name='flexRadioDefault']:checked").val();
        var radioAlpha = $(this).val();
        console.log(radioAlpha);
        e.preventDefault();
        if (radioAlpha) {
          document.querySelector("#alpha").value = radioAlpha;
        }
      });

      function restrictNumber(e) {
        var newValue = this.value.replace(new RegExp(/[^\d]/, "ig"), "");
        this.value = newValue;
      }

      var userName = document.querySelector("#numberField");
      userName.addEventListener("input", restrictNumber);
      var alphaName = document.querySelector("#alpha");
      alphaName.addEventListener("input", restrictNumber);
      var H = document.querySelector("#H");
      H.addEventListener("input", restrictNumber);
      var R = document.querySelector("#R");
      R.addEventListener("input", restrictNumber);
      var tAmbient = document.querySelector("#tAmbient");
      tAmbient.addEventListener("input", restrictNumber);
      var tAct = document.querySelector("#tAct");
      tAct.addEventListener("input", restrictNumber);
    });
  </script>

  <!-- Excel Generate Javascript Below -->
  <script>
    $(document).ready(function () {
      var RTI = $("input[name='RTI']").val();
      var R = $("input[name='R']").val();
      var H = $("input[name='H']").val();
      var radioAmbient = $("input[name='tAmbient']").val();
      var radioAct = $("input[name='tAct']").val();
      const numAmbientParsed = parseFloat(radioAmbient);
      const numActParsed = parseFloat(radioAct);
      var tAmbientVal = numAmbientParsed + 273;
      var tActVal = numActParsed + 273;
      var alphaVal = $("input[name='alpha']").val();
      var Vgas, Tgas, activationTime, fireSize, Q, tau, deltaT;

      $(".btn-clear").click(function () {
        $("form")[0].reset();
      });
      $("form").submit(function (event) {
        event.preventDefault(); // prevent default form submission

        var num1 = 0;
        var rti = $("input[name='RTI']").val();
        var H = $("input[name='H']").val();
        var R = $("input[name='R']").val();
        var alphaVal = $("input[name='alpha']").val();
        var radioAmbient = $("input[name='tAmbient']").val();
        var radioAct = $("input[name='tAct']").val();
        const numAmbientParsed = parseFloat(radioAmbient);
        const numActParsed = parseFloat(radioAct);
        var Activation = numAmbientParsed + 273;
        var Ambient = numActParsed + 273;
        var Tbulb = 293;
        var TbulbCounter = 0;
        let TactivationTimePrint = 0;
        let FireSizeOfQ = 0;
        // define the arrays to store the values
        var arr1 = [];
        var arr2 = [];
        var arr3 = [];
        var arr4 = [];
        var arr5 = [];
        var arr6 = [];

        // increment the numbers and store in the arrays until counter hits 100
        // vGas-result, tGas-result, activationTime-result, fireSize-result
        for (var i = 0; i < 3600; i++) {
          Q = alphaVal * Math.pow(i, 2);
          if (R / H > 0.15) {
            Vgas =
              (0.2 * (Math.pow(Q, 1 / 3) * Math.pow(H, 1 / 2))) /
              Math.pow(R, 5 / 6);
          }
          if (R / H <= 0.15) {
            Vgas = 0.95 * Math.pow(Q / H, 1 / 3);
          }
          if (R / H > 0.18) {
            Tgas = Ambient + (5.38 / H) * Math.pow(Q / R, 2 / 3);
          }
          if (R / H <= 0.18) {
            Tgas = Ambient + (16.9 * Math.pow(Q, 2 / 3)) / Math.pow(H, 5 / 3);
          }

          tau = rti / Math.sqrt(Vgas);
          deltaT = (1 / tau) * (Tgas - Ambient);
          TbulbCounter = Tbulb + deltaT;

          if (Math.round(TbulbCounter) >= Activation) {
            TactivationTimePrint = i;
            FireSizeOfQ = Q;
            break;
          }
          console.log(
            i,
            Q,
            Vgas,
            Tgas,
            TbulbCounter.toFixed(1),
            deltaT,
            Activation
          );

          num1++;
          arr1.push(i);
          arr2.push(Q.toFixed(2));
          arr3.push(Vgas.toFixed(2));
          arr4.push(Tgas.toFixed(2));
          arr5.push(deltaT.toFixed(2));
          arr6.push(Tbulb.toFixed(2));
        }
        // export the arrays to CSV
        var csv = "time,Q, Vgas, Tgas,deltaT, Tbulb\n";
        for (var i = 1; i < arr1.length; i++) {
          csv +=
            arr1[i] +
            "," +
            arr2[i] +
            "," +
            arr3[i] +
            "," +
            arr4[i] +
            "," +
            arr4[i] +
            "," +
            arr5[i] +
            "," +
            arr6[i] +
            "\n";
        }
        //Print Results
        console.log("Activation Time : ", TactivationTimePrint.toFixed(0));
        $("#activationTimeResult").html(
          Math.round(TactivationTimePrint) + " seconds"
        );
        console.log("Fire Size : ", FireSizeOfQ.toFixed(0));
        $("#fireSizeResult").html(Math.round(FireSizeOfQ) + " KW");

        //Download CSV
        // var link = document.createElement("a");
        // link.setAttribute(
        //   "href",
        //   "data:text/csv;charset=utf-8," + encodeURIComponent(csv)
        // );
        // link.setAttribute("download", "data.csv");
        // link.click();
      });
    });
  </script>
  <!-- Excel Generate Javascript Below -->
</html>
